### Яка різниця між PostgreSQL і MySQL

**Внутрішня структура.**
PostgreSQL працює на процесах, в той час як MySQL на потоках.
Для роботи з PostgreSQL для пришвидчення швидкодії та економії ресурсів рекомендується використовувати пул з'єднань - PgBouncer або PGPool. Це допоможе зекономити і на мережевих запитах - не потрібно буде кожен раз встановлювати з'єднання, і ресурси самого сервера - не треба буде наново створювати процеси. У MySQL є внутрішні механізми, які вміють кешувати ресурси, тобто не віддавати одразу операційній системі.

**Особливості зберігання даних.**
В MySQL для зберігання даних у таблицях використовуються різні двигуни. Двигун не має впливу на синтаксис запитів та їх виконання. Є підтримка MyISAM, InnoDB, MEMORY, Berkeley DB. Їхньою основною відмінністю є спосіб запису даних на диск та методи зчитування. PostgreSQL працює лише на двигуні зберігання даних. Таблиці організовані як об'єкти, а дії виконуються за допомогою об'єктно-орієнтованих функцій.

**Стандарти SQL.**
SQL - це стандартизована мова виконання запитів, яка використовується як в MySQL, так і в PostgreSQL. Цей стандарт має кілька версій і був розроблений ще в 1986 році.

MySQL підтримує не всі функції та можливості SQL. Це зроблено для того, щоб працювати з MySQL було просто та зручно. Але якщо для проекту необхідне яке-небудь розширення, розробники можуть додати його, не жертвуючи стандартом.

MySQL та PostgreSQL підтримують всі нові стандарти SQL, тобто по функціоналу ці СУБД на сьогодні відрізняються незначно.

**ACID.**
В обох системах використовується MVCC (MultiVersion Concurrency Control) - Керування паралельним доступом за допомогою багатоверсійності. Коли база даних, що використовує MVCC, потребує оновити елемент даних, вона не перепише оригінальний елемент даних новою інформацією, а створить новішу версію елементу даних. Таким чином зберігається декілька версій. Версія, що кожна транзакція бачить, залежить від того який рівень ізоляції реалізується.
В Postrgesql паралельно існують кілька версій рядка. Очищення відбувається за допомогою auto vacuum. Натомість MySQL зберігає завжди актуальну інформацію, а окремо зберігає інформацію про компенсуючу (undo) транзакцію, яка містить дельту, як повернути все назад. Тому займає менше місця, ніж в Postrgesql.
Auto vacuum затратний процес. Але якщо його запускати занадто рідко, то старі дані не будуть встигати очищатись, і таблиця буде "розпухати". Відповідно там де треба Sec Scan - він буде сканувати багато неактуальної інформації.
Тобто з великою кількістю транзакція MySQL працює краще.

**Можливості обробки даних.**
MySQL під час виконання запиту завантажує всю відповідь сервера в пам'ять клієнта. У випадку великих обсягів це не завжди зручно. Функціональності Postgresql ширші, ніж у Mysql. Наприклад, в Postgresql за допомогою курсора можна переміщувати отримані дані. Надається лише вказівник, а вся відповідь зберігається в пам'яті сервера баз даних. Цей вказівник можна зберігати між сеансами. PostgreSQL підтримує регулярні вирази у запитах, рекурсивні запити та успадкування таблиць.

**Продуктивність MySQL і Postgresql.**
Postgresql краще виконує складні аналітичні запити за багатьма JOIN, оскільки планувальник запитів має доступ до внутрішньої статистики. В свою чергу Storage Engine в MySQL надає API, оскільки є кілька його реалізацій. Тож Query execution engine не має доступу до всієї статистики для побудови оптимального запиту.

MySQL завжди був орієнтований на велику продуктивність, тоді як Postgresql був спрямований на багато налаштувань та стандартів. Але з часом ця ситуація змінилася, і Postgre став більш продуктивним.

Для організації роботи з базою даних в MySQL використовується таблиця InnoDB. Це означає, що MySQL буде значно швидше за Postgre при використанні первинного ключа.

Стосовно Postgresql, вся заголовкова інформація таблиць розміщується в оперативній пам'яті. Можна застосовувати кілька індексів до однієї таблиці для більшої зручності. Взагалі PostgreSQL працює швидше, крім ситуацій із використанням первинних ключів.

**Підтримувані типи даних.**
MySQL і Postgresql мають схожий набір типів, який має свої відмінності.

**Індекси.**
Є 2 основних типи архітектури індексів

- Кластерний індекс
    - Проіндексовані значення зберігаються разом з даними
    - Дані зберігаються в відсортованому вигляді в порядку, заданому індексом
    - У таблиці може бути тільки один індекс такого типу
- Некластерний індекс
    - Проіндексовані значення і дані зберігаються окремо
    - Індекс містить вказівники на решту даних рядка

Postgresql має тільки некластерні індекси, оскільки дані зберігаються окремо в табличній кучі (Table Heap).
Завдяки цьому Postgresql підтримує великий вибір вбудованих типів індексу - B-Tree Index, Hash Index, GIN, GiST, SP-GiST, BRIN.

Postgresql підтримує

- складні - дозволяє індексувати кілька стовпців (є і в MySql)
- часткові - дозволяє індексувати не всі значення, а які виконують певно умову
- функціональні індекси - дозволяє індексувати не оригінальне значення, а значення змінене якоюсь функцією

```sql
CREATE INDEX id_users_age_gender ON people(age, gender); -- complex
CREATE INDEX idx_users_age_partial ON people(age) where age >= 25; -— partial
CREATE INDEX idx_users_names ON people (LOWER(name) ); -- functional
```

У MySQL в таблиці може бути 1 кластерний та кілька некластерних вторинних індексів. І дані на диску завжди відсортовані на основі первинного ключа.
MySQL підтримує в явному вигляді тільки B-Tree Index, Hash Index створити не можна, але він використовується самим движком InnoDB в службових цілях.
MySQL підтримує Index Hints, що дає можливість вказати які індекси використовувати або ігнорувати.

```sql
SELECT * FROM table1 USE INDEX (col1_index, col2_index)
WHERE col1=1 AND col2=2 AND col3=3;

SELECT * FROM table1 IGNORE INDEX (col3_index)
WHERE col1=1 AND col2=2 AND col3=3;
```

*Links*

- [Сравнение MySQL и PostgreSQL](https://hyperhost.ua/info/ru/sravnenie-mysql-i-postgresql)
- [MySQL и PostgreSQL: что «под капотом» и почему это важно знать прикладному разработчику](https://youtu.be/mg70LYuRS3I?si=wfwM0e9mOt8KcXY2)
