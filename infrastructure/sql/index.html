<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=Andrew><link href=https://tavor118.github.io/python-questions-and-answers/infrastructure/sql/ rel=canonical><link href=../ rel=prev><link href=../database/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.15"><title>SQL - Python Questions and Answers</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../css/timeago.css><link rel=stylesheet href=../../stylesheets/extra.css><link rel=stylesheet href=../../stylesheets/links.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sql class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Python Questions and Answers" class="md-header__button md-logo" aria-label="Python Questions and Answers" data-md-component=logo> <img src=../../img/logo.bmp alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Python Questions and Answers </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SQL </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=light-blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/tavor118/pj_python_interview_questions_and_answers title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> tavor118/pj_python_interview_questions_and_answers </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Python Questions and Answers" class="md-nav__button md-logo" aria-label="Python Questions and Answers" data-md-component=logo> <img src=../../img/logo.bmp alt=logo> </a> Python Questions and Answers </label> <div class=md-nav__source> <a href=https://github.com/tavor118/pj_python_interview_questions_and_answers title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> tavor118/pj_python_interview_questions_and_answers </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../python/ class="md-nav__link "> <span class=md-ellipsis> Python </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python/general/ class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../python/syntax/ class=md-nav__link> <span class=md-ellipsis> Syntax </span> </a> </li> <li class=md-nav__item> <a href=../../python/data_types/ class=md-nav__link> <span class=md-ellipsis> Data Types </span> </a> </li> <li class=md-nav__item> <a href=../../python/sequences/ class=md-nav__link> <span class=md-ellipsis> Sequences </span> </a> </li> <li class=md-nav__item> <a href=../../python/set_and_dict/ class=md-nav__link> <span class=md-ellipsis> Set and Dict </span> </a> </li> <li class=md-nav__item> <a href=../../python/loops/ class=md-nav__link> <span class=md-ellipsis> Loops </span> </a> </li> <li class=md-nav__item> <a href=../../python/functions/ class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> <li class=md-nav__item> <a href=../../python/decorators/ class=md-nav__link> <span class=md-ellipsis> Decorators </span> </a> </li> <li class=md-nav__item> <a href=../../python/iterator_and_generator/ class=md-nav__link> <span class=md-ellipsis> Iterator and Generator </span> </a> </li> <li class=md-nav__item> <a href=../../python/class_and_object/ class=md-nav__link> <span class=md-ellipsis> Class and Object </span> </a> </li> <li class=md-nav__item> <a href=../../python/metaclass/ class=md-nav__link> <span class=md-ellipsis> Metaclass </span> </a> </li> <li class=md-nav__item> <a href=../../python/namespace_and_context_manager/ class=md-nav__link> <span class=md-ellipsis> Namespace and Context Manager </span> </a> </li> <li class=md-nav__item> <a href=../../python/modules_and_packets/ class=md-nav__link> <span class=md-ellipsis> Modules and Packets </span> </a> </li> <li class=md-nav__item> <a href=../../python/exceptions/ class=md-nav__link> <span class=md-ellipsis> Exceptions </span> </a> </li> <li class=md-nav__item> <a href=../../python/files_and_io/ class=md-nav__link> <span class=md-ellipsis> Files and IO </span> </a> </li> <li class=md-nav__item> <a href=../../python/async/ class=md-nav__link> <span class=md-ellipsis> Async </span> </a> </li> <li class=md-nav__item> <a href=../../python/gil_threads_processes/ class=md-nav__link> <span class=md-ellipsis> GIL Threads Processes </span> </a> </li> <li class=md-nav__item> <a href=../../python/interpreter/ class=md-nav__link> <span class=md-ellipsis> Interpreter </span> </a> </li> <li class=md-nav__item> <a href=../../python/functional_programming/ class=md-nav__link> <span class=md-ellipsis> Functional Programming </span> </a> </li> <li class=md-nav__item> <a href=../../python/standard_library/ class=md-nav__link> <span class=md-ellipsis> Standard Library </span> </a> </li> <li class=md-nav__item> <a href=../../python/python_packages/ class=md-nav__link> <span class=md-ellipsis> Python Packages </span> </a> </li> <li class=md-nav__item> <a href=../../python/coding/ class=md-nav__link> <span class=md-ellipsis> Coding </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../python_framework/ class="md-nav__link "> <span class=md-ellipsis> Python Framework </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Python Framework </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python_framework/django/ class=md-nav__link> <span class=md-ellipsis> Django </span> </a> </li> <li class=md-nav__item> <a href=../../python_framework/drf/ class=md-nav__link> <span class=md-ellipsis> DRF </span> </a> </li> <li class=md-nav__item> <a href=../../python_framework/fast_api/ class=md-nav__link> <span class=md-ellipsis> Fast API </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../computer_science/ class="md-nav__link "> <span class=md-ellipsis> Computer Science </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Computer Science </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../computer_science/oop/ class=md-nav__link> <span class=md-ellipsis> OOP </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/programming_principles/ class=md-nav__link> <span class=md-ellipsis> Programming Principles </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/solid/ class=md-nav__link> <span class=md-ellipsis> SOLID </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/data_structures/ class=md-nav__link> <span class=md-ellipsis> Data Structures </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/algorithmes/ class=md-nav__link> <span class=md-ellipsis> Algorithms </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/computer_science/ class=md-nav__link> <span class=md-ellipsis> Computer Science </span> </a> </li> <li class=md-nav__item> <a href=../../computer_science/testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../web_development/ class="md-nav__link "> <span class=md-ellipsis> Web Development </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Web Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../web_development/http/ class=md-nav__link> <span class=md-ellipsis> HTTP </span> </a> </li> <li class=md-nav__item> <a href=../../web_development/rest_soap/ class=md-nav__link> <span class=md-ellipsis> REST SOAP </span> </a> </li> <li class=md-nav__item> <a href=../../web_development/rpc/ class=md-nav__link> <span class=md-ellipsis> RPC </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Infrastructure </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=true> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Infrastructure </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> SQL </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> SQL </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sql class=md-nav__link> <span class=md-ellipsis> SQL </span> </a> <nav class=md-nav aria-label=SQL> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sql_1 class=md-nav__link> <span class=md-ellipsis> Що таке SQL </span> </a> </li> <li class=md-nav__item> <a href=#select-insert-update-delete class=md-nav__link> <span class=md-ellipsis> Оператори SELECT, INSERT, UPDATE та DELETE </span> </a> </li> <li class=md-nav__item> <a href=#sql-constraints class=md-nav__link> <span class=md-ellipsis> SQL Constraints </span> </a> </li> <li class=md-nav__item> <a href=#pk-primary-key-fk-foreign-key-unique-unique-constraint class=md-nav__link> <span class=md-ellipsis> PK - Primary Key, FK -Foreign Key, UNIQUE - Unique constraint </span> </a> </li> <li class=md-nav__item> <a href=#join class=md-nav__link> <span class=md-ellipsis> Оператор та види JOIN </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Підзапити </span> </a> </li> <li class=md-nav__item> <a href=#group-by class=md-nav__link> <span class=md-ellipsis> Агрегатні функції і GROUP BY </span> </a> </li> <li class=md-nav__item> <a href=#having-where class=md-nav__link> <span class=md-ellipsis> У чому різниця між операторами HAVING та WHERE? </span> </a> </li> <li class=md-nav__item> <a href=#union-union-all class=md-nav__link> <span class=md-ellipsis> UNION та UNION ALL </span> </a> </li> <li class=md-nav__item> <a href=#sql_2 class=md-nav__link> <span class=md-ellipsis> Функції в SQL </span> </a> </li> <li class=md-nav__item> <a href=#upsert class=md-nav__link> <span class=md-ellipsis> UPSERT </span> </a> </li> <li class=md-nav__item> <a href=#select-for-update class=md-nav__link> <span class=md-ellipsis> Що робить SELECT FOR UPDATE? </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Що таке віконні функції і як вони працюють? </span> </a> </li> <li class=md-nav__item> <a href=#row_number-rank-dense_rank class=md-nav__link> <span class=md-ellipsis> Агрегатні віконні функції ROW_NUMBER, RANK, DENSE_RANK </span> </a> </li> <li class=md-nav__item> <a href=#sql- class=md-nav__link> <span class=md-ellipsis> SQL ін'єкції - що таке, як захиститись? </span> </a> </li> <li class=md-nav__item> <a href=#view-materialised-view class=md-nav__link> <span class=md-ellipsis> View, Materialised View </span> </a> </li> <li class=md-nav__item> <a href=#explain-explain-analyze class=md-nav__link> <span class=md-ellipsis> EXPLAIN та EXPLAIN ANALYZE </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../database/ class=md-nav__link> <span class=md-ellipsis> Database </span> </a> </li> <li class=md-nav__item> <a href=../mq/ class=md-nav__link> <span class=md-ellipsis> MQ </span> </a> </li> <li class=md-nav__item> <a href=../docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> <li class=md-nav__item> <a href=../kubernates/ class=md-nav__link> <span class=md-ellipsis> Kubernates </span> </a> </li> <li class=md-nav__item> <a href=../server/ class=md-nav__link> <span class=md-ellipsis> Server </span> </a> </li> <li class=md-nav__item> <a href=../aws/ class=md-nav__link> <span class=md-ellipsis> AWS </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../../architecture/ class="md-nav__link "> <span class=md-ellipsis> Architecture </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../architecture/architecture_patterns/ class=md-nav__link> <span class=md-ellipsis> Architecture Patterns </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/ddd/ class=md-nav__link> <span class=md-ellipsis> DDD </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/system_design/ class=md-nav__link> <span class=md-ellipsis> System Design </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8> <div class="md-nav__link md-nav__container"> <a href=../../development/ class="md-nav__link "> <span class=md-ellipsis> Development </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/git/ class=md-nav__link> <span class=md-ellipsis> Git </span> </a> </li> <li class=md-nav__item> <a href=../../development/ci_cd/ class=md-nav__link> <span class=md-ellipsis> CI/CD </span> </a> </li> <li class=md-nav__item> <a href=../../development/sdlc/ class=md-nav__link> <span class=md-ellipsis> SDLC </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../../frontend/ class="md-nav__link "> <span class=md-ellipsis> Front-end </span> </a> <label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Front-end </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../frontend/front_end/ class=md-nav__link> <span class=md-ellipsis> Front End </span> </a> </li> <li class=md-nav__item> <a href=../../frontend/javascript/ class=md-nav__link> <span class=md-ellipsis> JavaScript </span> </a> </li> <li class=md-nav__item> <a href=../../frontend/dom/ class=md-nav__link> <span class=md-ellipsis> DOM </span> </a> </li> <li class=md-nav__item> <a href=../../frontend/framework/ class=md-nav__link> <span class=md-ellipsis> Framework </span> </a> </li> <li class=md-nav__item> <a href=../../frontend/html/ class=md-nav__link> <span class=md-ellipsis> HTML </span> </a> </li> <li class=md-nav__item> <a href=../../frontend/css/ class=md-nav__link> <span class=md-ellipsis> CSS </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sql class=md-nav__link> <span class=md-ellipsis> SQL </span> </a> <nav class=md-nav aria-label=SQL> <ul class=md-nav__list> <li class=md-nav__item> <a href=#sql_1 class=md-nav__link> <span class=md-ellipsis> Що таке SQL </span> </a> </li> <li class=md-nav__item> <a href=#select-insert-update-delete class=md-nav__link> <span class=md-ellipsis> Оператори SELECT, INSERT, UPDATE та DELETE </span> </a> </li> <li class=md-nav__item> <a href=#sql-constraints class=md-nav__link> <span class=md-ellipsis> SQL Constraints </span> </a> </li> <li class=md-nav__item> <a href=#pk-primary-key-fk-foreign-key-unique-unique-constraint class=md-nav__link> <span class=md-ellipsis> PK - Primary Key, FK -Foreign Key, UNIQUE - Unique constraint </span> </a> </li> <li class=md-nav__item> <a href=#join class=md-nav__link> <span class=md-ellipsis> Оператор та види JOIN </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> Підзапити </span> </a> </li> <li class=md-nav__item> <a href=#group-by class=md-nav__link> <span class=md-ellipsis> Агрегатні функції і GROUP BY </span> </a> </li> <li class=md-nav__item> <a href=#having-where class=md-nav__link> <span class=md-ellipsis> У чому різниця між операторами HAVING та WHERE? </span> </a> </li> <li class=md-nav__item> <a href=#union-union-all class=md-nav__link> <span class=md-ellipsis> UNION та UNION ALL </span> </a> </li> <li class=md-nav__item> <a href=#sql_2 class=md-nav__link> <span class=md-ellipsis> Функції в SQL </span> </a> </li> <li class=md-nav__item> <a href=#upsert class=md-nav__link> <span class=md-ellipsis> UPSERT </span> </a> </li> <li class=md-nav__item> <a href=#select-for-update class=md-nav__link> <span class=md-ellipsis> Що робить SELECT FOR UPDATE? </span> </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> <span class=md-ellipsis> Що таке віконні функції і як вони працюють? </span> </a> </li> <li class=md-nav__item> <a href=#row_number-rank-dense_rank class=md-nav__link> <span class=md-ellipsis> Агрегатні віконні функції ROW_NUMBER, RANK, DENSE_RANK </span> </a> </li> <li class=md-nav__item> <a href=#sql- class=md-nav__link> <span class=md-ellipsis> SQL ін'єкції - що таке, як захиститись? </span> </a> </li> <li class=md-nav__item> <a href=#view-materialised-view class=md-nav__link> <span class=md-ellipsis> View, Materialised View </span> </a> </li> <li class=md-nav__item> <a href=#explain-explain-analyze class=md-nav__link> <span class=md-ellipsis> EXPLAIN та EXPLAIN ANALYZE </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>SQL</h1> <h3 id=sql>SQL<a class=headerlink href=#sql title="Permanent link">⚑</a></h3> <h4 id=sql_1>Що таке SQL<a class=headerlink href=#sql_1 title="Permanent link">⚑</a></h4> <p><strong>SQL (Structured Query Language)</strong> — це мова для роботи з реляційними базами даних, що використовується для створення, модифікації, управління та отримання даних. Вона є стандартом для більшості сучасних реляційних СУБД, таких як MySQL, PostgreSQL, SQLite та інші.</p> <ul> <li>SQL дозволяє створювати структуру бази даних через команди створення таблиць, індексів, та зв’язків між таблицями.</li> <li>Основні операції SQL включають <code>SELECT</code> для вибірки даних, <code>INSERT</code> для додавання, <code>UPDATE</code> для оновлення та <code>DELETE</code> для видалення записів.</li> <li>SQL підтримує складні запити за допомогою умов <code>WHERE</code>, сортування <code>ORDER BY</code>, агрегації даних <code>GROUP BY</code>, а також функцій для роботи з підзапитами та об'єднання таблиць (<code>JOIN</code>).</li> <li>Мова SQL є декларативною, тобто користувач описує, що він хоче отримати або змінити, а не як саме це потрібно зробити.</li> <li>У сучасних застосунках SQL часто використовується через ORM (Object-Relational Mapping) інструменти, такі як SQLAlchemy для Python, що дозволяє взаємодіяти з базою даних через об'єкти класів замість прямого написання SQL-коду.</li> </ul> <p>Приклад базового запиту SQL для вибірки всіх користувачів з бази даних:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>18</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>ASC</span><span class=p>;</span>
</span></code></pre></div> <h4 id=select-insert-update-delete>Оператори <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code> та <code>DELETE</code><a class=headerlink href=#select-insert-update-delete title="Permanent link">⚑</a></h4> <p>Призначення операторів</p> <ul> <li><code>SELECT</code> для вибірки даних</li> <li><code>INSERT</code> для додавання записів</li> <li><code>UPDATE</code> для оновлення записів</li> <li><code>DELETE</code> для видалення записів</li> </ul> <p>Оператор <code>SELECT</code> використовується для вилучення даних з бази даних. Він дозволяє вибирати певні стовпці з таблиці, фільтрувати дані за умовами, сортувати, групувати і виконувати інші операції над даними. </p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>condition</span><span class=p>;</span>
</span></code></pre></div> <p>Оператор <code>INSERT</code> використовується для вставки нових даних у таблицю. Він дозволяє вказувати значення для стовпців або вставляти значення з іншої таблиці. </p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=p>(</span><span class=n>column1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=p>)</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=n>value1</span><span class=p>,</span><span class=w> </span><span class=n>value2</span><span class=p>);</span>
</span></code></pre></div> <p>Оператор <code>UPDATE</code> використовується для зміни даних у таблиці. Він дозволяє оновлювати значення стовпців у певних рядках таблиці. Можна вказувати умови для фільтрації даних, які потрібно оновити. </p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>UPDATE</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>column1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value1</span><span class=p>,</span><span class=w> </span><span class=n>column2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value2</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>condition</span><span class=p>;</span>
</span></code></pre></div> <p>Оператор <code>DELETE</code> використовується для видалення даних з таблиці. Він дозволяє видаляти певні рядки таблиці на основі умов.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>DELETE</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>condition</span>
</span></code></pre></div> <h4 id=sql-constraints>SQL Constraints<a class=headerlink href=#sql-constraints title="Permanent link">⚑</a></h4> <p><strong>Обмеження (Constraints)</strong> використовуються для визначення правил для даних у таблиці.</p> <p>Обмеження використовуються для обмеження типу даних, які можуть входити в таблицю. Це забезпечує точність і достовірність даних у таблиці. Якщо існує будь-який конфлікт між обмеженням і дією з даними, дія переривається.</p> <p>Обмеження можуть бути на рівні стовпця або таблиці. Обмеження рівня стовпця застосовуються до стовпця, а обмеження рівня таблиці застосовуються до всієї таблиці.</p> <p>Перелік обмежень</p> <ul> <li><code>NOT NULL</code> - гарантує, що стовпець не може мати значення <code>NULL</code></li> <li><code>UNIQUE</code> – гарантує, що всі значення в стовпці відрізняються</li> <li><code>PRIMARY KEY</code> - комбінація <code>NOT NULL</code> і <code>UNIQUE</code>. Унікально визначає кожен рядок у таблиці</li> <li><code>FOREIGN KEY</code> - однозначно ідентифікує рядок/запис в іншій таблиці</li> <li><code>CHECK</code> - гарантує, що всі значення в стовпці задовольняють певну умову</li> </ul> <h4 id=pk-primary-key-fk-foreign-key-unique-unique-constraint>PK - Primary Key, FK -Foreign Key, UNIQUE - Unique constraint<a class=headerlink href=#pk-primary-key-fk-foreign-key-unique-unique-constraint title="Permanent link">⚑</a></h4> <p><strong>Primary Key (Первинний Ключ)</strong> - це унікальний ідентифікатор (стовпець або комбінація стовпців), який визначає конкретний запис в базі даних. Він гарантує унікальність кожного запису в таблиці і дозволяє ефективно виконувати пошук та звертатися до конкретних даних. Кожна таблиця може мати лише один первинний ключ.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=n>username</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=p>);</span>
</span></code></pre></div> <p><strong>Foreign Key (Зовнішній Ключ)</strong> - це поле в таблиці бази даних, яке вказує на Primary Key іншої таблиці. Він встановлює зв'язок між двома таблицями, дозволяючи одній таблиці посилатися на дані в іншій. Це використовується для створення зв'язків між таблицями та забезпечення цілісності даних в базі даних. Таблиця може мати кілька зовнішніх ключів, що вказують на її зв'язок із різними таблицями.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=n>id</span><span class=w> </span><span class=nb>SERIAL</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>REFERENCES</span><span class=w> </span><span class=n>users</span><span class=p>(</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=p>);</span>
</span></code></pre></div> <p><code>UNIQUE</code> – обмеження гарантує унікальність значень - всі значення стовпця відрізняються один від одного. Обмеження первинного ключа має автоматичне обмеження на унікальність. В таблиці можна мати багато унікальних обмежень, але тільки одне обмеження первинного ключа таблиці.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w> </span><span class=n>id</span><span class=w> </span><span class=nb>int</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w> </span><span class=n>email</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>255</span><span class=p>)</span><span class=w> </span><span class=k>UNIQUE</span><span class=p>,</span><span class=w> </span><span class=c1>-- all the emails shoud be unique</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w> </span><span class=k>CONSTRAINT</span><span class=w> </span><span class=n>pk_user</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=p>);</span>
</span></code></pre></div> <h4 id=join>Оператор та види <code>JOIN</code><a class=headerlink href=#join title="Permanent link">⚑</a></h4> <p>Оператор <code>JOIN</code> в SQL використовується для об'єднання даних з двох або більше таблиць на основі визначених умов. <code>JOIN</code> дозволяє комбінувати дані з різних таблиць в один результат.</p> <p>Умова з'єднання вказується в реченні <code>ON</code>. Ця умова визначає, які рядки двох вихідних таблиць вважаються "відповідними" один одному.</p> <p>Слова <code>INNER</code> та <code>OUTER</code> не є обов'язковими у всіх формах. За замовчуванням передбачається INNER<code></code>(внутрішнє з'єднання), а при вказанні <code>LEFT</code>, <code>RIGHT</code> і <code>FULL</code> - зовнішнє з'єднання.</p> <p>Види джойнів</p> <ul> <li><code>JOIN</code> (<code>INNER JOIN</code>)</li> <li><code>LEFT JOIN</code> (<code>LEFT OUTER JOIN</code>)</li> <li><code>RIGHT JOIN</code> (<code>RIGHT OUTER JOIN</code>)</li> <li><code>FULL JOIN</code> (<code>FULL OUTER JOIN</code>)</li> <li> <p><code>CROSS JOIN</code></p> </li> <li> <p><code>INNER JOIN</code> - Повертає ті рядки, які мають відповідні значення в обох таблицях.</p> </li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_name</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=k>JOIN</span><span class=w> </span><span class=n>Customers</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_id</span><span class=p>;</span>
</span></code></pre></div> <ul> <li><code>LEFT OUTER JOIN</code> - Повертає всі рядки з лівої (першої) таблиці та відповідні значення з правої (другої) таблиці. Якщо відповідних значень немає, повертається <code>NULL</code>.</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>order_id</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Orders</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>customer_id</span><span class=p>;</span>
</span></code></pre></div> <ul> <li><code>RIGHT OUTER JOIN</code> - Повертає всі рядки з правої (другої) таблиці та відповідні значення з лівої (першої) таблиці. Якщо відповідних значень немає, повертається <code>NULL</code>. Це з'єднання є протилежним до лівого (<code>LEFT JOIN</code>).</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span><span class=w> </span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=k>RIGHT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Orders</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>customer_id</span><span class=p>;</span>
</span></code></pre></div> <ul> <li><code>FULL OUTER JOIN</code> - Повертає всі рядки з обох таблиць, і якщо відповідних значень немає, повертається <code>NULL</code>. Фактично це одночасний <code>LEFT</code> та <code>RIGHT JOIN</code>.</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span><span class=w> </span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=k>FULL</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Orders</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>customer_id</span><span class=p>;</span>
</span></code></pre></div> <ul> <li><code>CROSS JOIN</code> - Повертає декартовий добуток (комбінацію) всіх рядків із першої таблиці та всіх рядків із другої таблиці.</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span><span class=w> </span><span class=n>Products</span><span class=p>.</span><span class=n>product_name</span><span class=w> </span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span><span class=w> </span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>CROSS</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>Products</span><span class=p>;</span>
</span></code></pre></div> <p>Латеральний JOIN, (<code>LATERAL JOIN</code>) дозволяє використовувати результати попереднього запиту як джерело даних для подальших операцій JOIN, що дозволяє створювати більш складні і гнучкі запити.</p> <p>Основна властивість латерального JOIN полягає в тому, що він дозволяє включати підзапити, які "бачать" дані з рядків, отриманих від зовнішніх таблиць. Це дозволяє використовувати значення з поточного рядка як параметр для підзапиту, що в свою чергу дозволяє гнучко маніпулювати даними.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>employee_name</span><span class=p>,</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>task_name</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=n>e</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=k>LATERAL</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>task_name</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>tasks</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>tasks</span><span class=p>.</span><span class=n>employee_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>employee_id</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=c1>-- Limit the number of tasks per employee, for example</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=k>true</span><span class=p>;</span>
</span></code></pre></div> <h4 id=_1>Підзапити<a class=headerlink href=#_1 title="Permanent link">⚑</a></h4> <p><strong>Підзапити SQL</strong> - це запити, вкладені всередині інших запитів.</p> <p>Підзапити можуть бути використані для створення складних і гнучких запитів, які вимагають більш складної логіки або операцій з даними. Підзапити можуть використовуватися в різних частинах SQL-запиту, таких як <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>HAVING</code> та інших.</p> <p>Підзапити можуть бути менш ефективними з точки зору продуктивності, особливо під час роботи з великими обсягами даних. Вони можуть призвести до підвищеного часу виконання запитів та навантаження на базу даних. В таких випадках можна спробувати замінити підзапит на <code>JOIN</code>.</p> <p>Підзапит в операторі <code>SELECT</code></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>product_name</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>price</span><span class=p>)</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>prices</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>products</span><span class=p>.</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>avg_price</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>FROM</span><span class=w> </span><span class=n>products</span><span class=p>;</span>
</span></code></pre></div> <p>Підзапит в операторі <code>FROM</code></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>product_name</span><span class=p>,</span><span class=w> </span><span class=n>price</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=k>FROM</span><span class=w> </span><span class=n>products</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=k>JOIN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>price</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>avg_price</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>prices</span><span class=w> </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>product_id</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>subquery</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=k>ON</span><span class=w> </span><span class=n>products</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>subquery</span><span class=p>.</span><span class=n>product_id</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=k>WHERE</span><span class=w> </span><span class=n>price</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>subquery</span><span class=p>.</span><span class=n>avg_price</span><span class=p>;</span>
</span></code></pre></div> <p>Підзапит в операторі <code>WHERE</code></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>customer_id</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>FROM</span><span class=w> </span><span class=n>orders</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>customers</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>customer_type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;premium&#39;</span><span class=p>);</span>
</span></code></pre></div> <h4 id=group-by>Агрегатні функції і <code>GROUP BY</code><a class=headerlink href=#group-by title="Permanent link">⚑</a></h4> <p>Агрегатні функції SQL використовуються для обчислення агрегатних значень на основі даних в стовпцях таблиці. </p> <p>Основні агрегатні функції SQL</p> <ul> <li><code>COUNT</code></li> <li><code>SUM</code></li> <li><code>AVG</code></li> <li><code>MIN</code></li> <li><code>MAX</code></li> </ul> <p><code>COUNT</code> Повертає кількість рядків або значень у стовпці. Може використовуватися з модифікатором <code>DISTINCT</code> для розрахунку унікальних значень.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_orders</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span><span class=p>;</span>
</span></code></pre></div> <p><code>SUM</code> Повертає суму значень у стовпці. Може використовуватись лише з числовими стовпцями.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>order_total</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span><span class=p>;</span>
</span></code></pre></div> <p><code>AVG</code> Повертає середнє значення значень у стовпці. Може використовуватись лише з числовими стовпцями.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>AVG</span><span class=p>(</span><span class=n>order_total</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_order_total</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span><span class=p>;</span>
</span></code></pre></div> <p><code>MIN</code> Повертає мінімальне значення у стовпці. Може використовуватись з будь-яким типом даних.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>MIN</span><span class=p>(</span><span class=n>order_date</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>earliest_order_date</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span><span class=p>;</span>
</span></code></pre></div> <p><code>MAX</code> Повертає максимальне значення у стовпці. Може використовуватись з будь-яким типом даних.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>sqlCopy</span><span class=w> </span><span class=n>code</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=k>SELECT</span><span class=w> </span><span class=k>MAX</span><span class=p>(</span><span class=n>order_date</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>latest_order_date</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span><span class=p>;</span>
</span></code></pre></div> <p>Оператори GROUP BY, HAVING використовуються спільно з агрегатними функціями для виконання агрегації на рівні груп або для створення зведених звітів.</p> <p><code>GROUP BY</code> Використовується для угруповання результатів по одному або декільком стовпцям.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>order_count</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>customer_id</span><span class=p>;</span>
</span></code></pre></div> <p><code>HAVING</code> Використовується для фільтрації груп після застосування GROUP BY на основі умов, заданих у HAVING.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>order_count</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=k>FROM</span><span class=w> </span><span class=n>Orders</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>customer_id</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=k>HAVING</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>5</span><span class=p>;</span>
</span></code></pre></div> <h4 id=having-where>У чому різниця між операторами <code>HAVING</code> та <code>WHERE</code>?<a class=headerlink href=#having-where title="Permanent link">⚑</a></h4> <p>Оператор <code>HAVING</code> використовується у зв'язці з <code>GROUP BY</code>, щоб фільтрувати рядки на основі агрегатних функцій. У свою чергу оператор <code>WHERE</code> фільтрує рядки перед групуванням. Простіше кажучи <code>WHERE</code> використовується для звуження пошуку на рівні рядків, а <code>HAVING</code> вибирає конкретні результати після групування.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>department</span><span class=p>,</span><span class=w> </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_employees</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=k>FROM</span><span class=w> </span><span class=n>employees</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>department</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=k>HAVING</span><span class=w> </span><span class=n>total_employees</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span><span class=p>;</span>
</span></code></pre></div> <h4 id=union-union-all><code>UNION</code> та <code>UNION ALL</code><a class=headerlink href=#union-union-all title="Permanent link">⚑</a></h4> <p><code>UNION</code> та <code>UNION ALL</code> використовуються для об’єднання результатів кількох запитів у один набір даних. - <code>UNION</code> видаляє дублікати зі з'єднаного набору результатів. Використовується, коли потрібен унікальний список значень, при цьому виконує додаткову перевірку для усунення дублікатів, що може уповільнити виконання запиту на великих наборах даних. - <code>UNION ALL</code> зберігає всі записи, включаючи дублікати.</p> <p>Обидва оператори вимагають, щоб кількість і типи стовпців у всіх запитах, що об'єднуються, збігалися. </p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1>-- Union example, duplicates will be removed</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=k>SELECT</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>table1</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=k>UNION</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=k>SELECT</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>table2</span><span class=p>;</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=c1>-- Union All example, duplicates will be kept</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=k>SELECT</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>table1</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=k>SELECT</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>table2</span><span class=p>;</span>
</span></code></pre></div> <h4 id=sql_2>Функції в SQL<a class=headerlink href=#sql_2 title="Permanent link">⚑</a></h4> <p>Рядкові функції</p> <ul> <li><code>CONCAT()</code><ul> <li>Об'єднання двох або більше рядків.</li> <li><code>SELECT CONCAT('Hello', 'World');</code> -- Результат: 'HelloWorld'</li> </ul> </li> <li><code>LENGTH()</code><ul> <li>Повертає довжину рядка.</li> <li><code>SELECT LENGTH('Hello');</code> -- Результат: 5</li> </ul> </li> <li><code>UPPER()</code><ul> <li>Перетворення рядка у верхній регістр.</li> <li><code>SELECT UPPER('hello');</code> -- Результат: 'HELLO'</li> </ul> </li> <li><code>LOWER()</code><ul> <li>Перетворення рядка на нижній регістр.</li> <li><code>SELECT LOWER('WORLD');</code> -- Результат: 'world'</li> </ul> </li> <li><code>SUBSTRING()</code><ul> <li>Вилучення підрядка з рядка.</li> <li><code>SELECT SUBSTRING('HelloWorld', 6, 5);</code> -- Результат: 'World'</li> </ul> </li> </ul> <p>Математичні функції</p> <ul> <li><code>ABS()</code><ul> <li>Повертає абсолютне значення числа.</li> <li><code>SELECT ABS(-5);</code>-- Результат: 5</li> </ul> </li> <li><code>ROUND()</code><ul> <li>Округлення числа до заданої кількості знаків після коми.</li> <li><code>SELECT ROUND (3.14159, 2);</code> -- Результат: 3.14</li> </ul> </li> <li><code>CEILING()</code><ul> <li>Округлення числа у велику сторону до найближчого цілого.</li> <li><code>SELECT CEILING (3.2);</code> -- Результат: 4</li> </ul> </li> <li><code>FLOOR()</code><ul> <li>Округлення числа в меншу сторону до найближчого цілого.</li> <li><code>SELECT FLOOR(3.8);</code> -- Результат: 3</li> </ul> </li> <li><code>RAND()</code><ul> <li>Генерація випадкового числа.</li> <li><code>SELECT RAND();</code> -- Результат: випадкове число від 0 до 1</li> </ul> </li> </ul> <p>Інші функції</p> <ul> <li><code>COALESCE()</code><ul> <li>Повертає перше ненульове значення зі списку значень.</li> <li><code>SELECT COALESCE(column1, column2, column3, 'N/A') FROM table1;</code></li> </ul> </li> <li><code>NULLIF()</code><ul> <li>Повертає NULL, якщо два значення дорівнюють.</li> <li><code>SELECT NULLIF(column1, 0) FROM table1;</code></li> </ul> </li> <li><code>CASE()</code><ul> <li>Виконує умовну логіку SQL запиту.</li> <li><code>SELECT column1, CASE WHEN column1 &gt; 0 THEN 'Positive' ELSE 'Negative' END FROM table1;</code></li> </ul> </li> </ul> <h4 id=upsert><code>UPSERT</code><a class=headerlink href=#upsert title="Permanent link">⚑</a></h4> <p><code>UPSERT</code> (update or insert) у SQL — це операція, яка дозволяє вставляти нові рядки у таблицю або оновлювати існуючі, якщо такі вже присутні. Це корисно для забезпечення цілісності даних та уникнення дублювання записів. Залежно від бази даних, синтаксис UPSERT може відрізнятися. </p> <ul> <li>У PostgreSQL UPSERT реалізується через <code>INSERT ... ON CONFLICT</code>. Ви вказуєте, що робити у разі конфлікту (наприклад, оновити дані).</li> <li>У MySQL використовують <code>INSERT ... ON DUPLICATE KEY UPDATE</code>. Це оновлює рядок, якщо ключ уже існує.</li> <li>У SQLite UPSERT доступний через <code>INSERT ... ON CONFLICT</code>.</li> <li>У Oracle використовують <code>MERGE</code> для реалізації UPSERT-поведінки.</li> </ul> <p>Приклад для PostgreSQL</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>email</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;John Doe&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;john.doe@example.com&#39;</span><span class=p>)</span><span class=w> </span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=k>ON</span><span class=w> </span><span class=n>CONFLICT</span><span class=w> </span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w>  </span><span class=c1>-- identifies the field causing the conflict</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=k>DO</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>SET</span><span class=w> </span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXCLUDED</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXCLUDED</span><span class=p>.</span><span class=n>email</span><span class=p>;</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=c1>-- &quot;EXCLUDED&quot; is a special reference to the data being attempted to be inserted</span>
</span></code></pre></div> <p>Цей запит вставить новий запис, якщо <code>id</code> не існує, або оновить <code>name</code> та <code>email</code>, якщо запис із таким <code>id</code> уже присутній.</p> <h4 id=select-for-update>Що робить SELECT FOR UPDATE?<a class=headerlink href=#select-for-update title="Permanent link">⚑</a></h4> <p><code>SELECT FOR UPDATE</code> – це SQL-конструкція, яка використовується для блокування рядків, що вибираються під час виконання запиту, щоб уникнути конкурентних змін даних. Ця конструкція зазвичай застосовується в транзакціях для забезпечення консистентності даних.</p> <p>Вона виконує ексклюзивне блокування рядків, які відповідають умовам запиту, і дозволяє тільки одному процесу або транзакції читати або змінювати ці рядки. Інші транзакції, що спробують виконати <code>SELECT FOR UPDATE</code> для цих же рядків, будуть чекати, поки поточна транзакція завершиться (коміт або ролбек).</p> <p>Зазвичай використовується, коли є потреба прочитати дані, провести певні обчислення та потім оновити ці дані без ризику, що інша транзакція зможе змінити їх між читанням і записом. Це важливо для уникнення проблем, таких як race conditions.</p> <p>Недоліком є те, що використання <code>SELECT FOR UPDATE</code> може призвести до зменшення швидкодії за рахунок блокування ресурсів та можливих deadlock-ів. Тому його треба застосовувати з обережністю в системах з високою конкуренцією запитів.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=k>BEGIN</span><span class=p>;</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=c1>-- Selecting rows for update</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>orders</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pending&#39;</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=k>FOR</span><span class=w> </span><span class=k>UPDATE</span><span class=p>;</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=c1>-- Performing update based on previous select</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=k>UPDATE</span><span class=w> </span><span class=n>orders</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=k>SET</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;processing&#39;</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=k>WHERE</span><span class=w> </span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;pending&#39;</span><span class=p>;</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=k>COMMIT</span><span class=p>;</span>
</span></code></pre></div> <h4 id=_2>Що таке віконні функції і як вони працюють?<a class=headerlink href=#_2 title="Permanent link">⚑</a></h4> <p><strong>Віконні функції</strong> - це засіб в SQL, який дозволяє виконувати обчислення на підмножині рядків з результатами запиту і керувати їх порядком та групуванням. Вони корисні для виконання аналізу даних на рівні рядків і дозволяють враховувати взаємозв'язані дані при обчисленнях.</p> <p>У PostgreSQL можна використовувати віконні функції, використовуючи ключове слово <code>OVER</code>. Наприклад, давайте припустимо, що у нас є таблиця <code>orders</code> зі стовпцями <code>order_date</code>, <code>customer_id</code> і <code>order_amount</code>. Ми можемо використовувати віконну функцію <code>SUM</code> для обчислення кумулятивної суми замовлень для кожного клієнта впродовж часу.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=w>    </span><span class=n>order_date</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>    </span><span class=n>customer_id</span><span class=p>,</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=n>order_amount</span><span class=p>,</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>order_amount</span><span class=p>)</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>order_date</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>cumulative_order_amount</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=k>FROM</span><span class=w> </span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=n>orders</span><span class=p>;</span>
</span></code></pre></div> <p>У цьому запиті ми використовуємо функцію <code>SUM(order_amount) OVER (PARTITION BY customer_id ORDER BY order_date)</code>. Частина <code>PARTITION BY customer_id</code> розділяє дані на групи за <code>customer_id</code>, а <code>ORDER BY order_date</code> визначає порядок сортування за датою замовлення.</p> <p>Таким чином, для кожного рядка ми отримаємо значення кумулятивної суми суми замовлень для відповідного клієнта на даний момент.</p> <p>Досягти того ж результату, що і у вище наведеному прикладі, можна використовуючи <code>GROUP BY</code>.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=k>SELECT</span><span class=w> </span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=n>order_date</span><span class=p>,</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=n>customer_id</span><span class=p>,</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=n>order_amount</span><span class=p>,</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>order_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>cumulative_order_amount</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=k>FROM</span><span class=w> </span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>    </span><span class=n>orders</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=n>order_date</span><span class=p>,</span><span class=w> </span><span class=n>order_amount</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=n>order_date</span><span class=p>;</span>
</span></code></pre></div> <p>Обидва запити дають однаковий результат - кумулятивну суму сум замовлень для кожного клієнта на основі дати замовлення. Однак, використання віконних функцій дозволяє уникнути необхідності вказувати всі стовпці з запиту в розділі <code>GROUP BY</code>. Використання <code>OVER</code> і <code>PARTITION BY</code> дозволяє більш гнучко визначити, як розподілити дані для обчислень, і отримати більш зрозумілий і компактний код.</p> <p>В більшості випадків використання віконних функцій є більш ефективним та швидким способом порівняно з використанням <code>GROUP BY</code>, особливо при роботі з великими наборами даних. Віконні функції дозволяють виконувати обчислення на підмножині рядків без потреби створювати окремі групи. Це може призвести до кращої продуктивності, оскільки система управління базами даних може оптимізувати розрахунки в межах віконного фрейму.</p> <p>При використанні підходу <code>GROUP BY</code> база даних має створювати відмінні групи на основі стовпців групування, що може включати додаткові кроки сортування та агрегації. Цей процес може стати більш витратним з точки зору ресурсів зі збільшенням обсягу даних.</p> <h4 id=row_number-rank-dense_rank>Агрегатні віконні функції <code>ROW_NUMBER</code>, <code>RANK</code>, <code>DENSE_RANK</code><a class=headerlink href=#row_number-rank-dense_rank title="Permanent link">⚑</a></h4> <p><strong>Агрегатні віконні функції</strong> SQL дозволяють агрегувати дані всередині певного вікна або діапазону рядків, визначеного за допомогою віконного виразу. Віконні функції можуть бути корисними для аналізу даних, таких як ранжування, обчислення відмінностей між значеннями, знаходження першого або останнього значення всередині вікна та інших аналітичних операцій.</p> <p>Віконні функції</p> <ul> <li><code>ROW_NUMBER</code></li> <li><code>RANK</code></li> <li><code>DENSE_RANK</code></li> </ul> <p><code>ROW_NUMBER()</code> Повертає порядковий номер рядка всередині вікна. Нумерація починається з першої.</p> <p>Наступний запит обирає ідентифікатор, ім'я та оцінку студентів з таблиці "students" та призначає їм порядкові номери всередині вікна, відсортованого за зменшенням оцінок.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>DESC</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>row_num</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=k>FROM</span><span class=w> </span><span class=n>students</span>
</span></code></pre></div> <p><code>RANK()</code> Повертає ранг (порядковий номер) рядка всередині вікна, пропускаючи дублікати, та пропускаючи наступний порядковий номер у разі, якщо кілька рядків мають одне й те саме значення.</p> <p>Наступний запит обирає ідентифікатор, ім'я та оцінку студентів з таблиці "students" і призначає їм ранги всередині вікна, відсортованого за спаданням оцінок, пропускаючи дублікати оцінок.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>RANK</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>DESC</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>rank_num</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=k>FROM</span><span class=w> </span><span class=n>students</span>
</span></code></pre></div> <p><code>DENSE_RANK()</code> Повертає щільний ранг (порядковий номер) рядка всередині вікна, не пропускаючи дублікати, і не пропускаючи наступний порядковий номер у випадку, якщо кілька рядків мають те саме значення.</p> <p>Наступний запит обирає ідентифікатор, ім'я та оцінку студентів з таблиці "students" та призначає їм щільні ранги всередині вікна, відсортованого за спаданням оцінок, без пропуску дублікатів оцінок.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=n>sqlCopy</span><span class=w> </span><span class=n>code</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>DENSE_RANK</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>DESC</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>dense_rank_num</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=k>FROM</span><span class=w> </span><span class=n>students</span>
</span></code></pre></div> <h4 id=sql->SQL ін'єкції - що таке, як захиститись?<a class=headerlink href=#sql- title="Permanent link">⚑</a></h4> <p><strong>SQL-ін'єкції</strong> — це один із найпоширеніших типів атак на базу даних, коли зловмисник вставляє шкідливий SQL-код у запит, що виконується сервером. Це може призвести до витоку даних, модифікації бази або навіть повного видалення даних.</p> <p>Основна причина SQL-ін'єкцій — неправильна обробка даних, які надходять від користувача, та їх безпосереднє використання у SQL-запитах. Наслідки атак можуть бути дуже серйозними: викрадення конфіденційної інформації, несанкціоновані зміни даних, створення облікових записів з підвищеними привілеями тощо.</p> <p>Приклад небезпечного коду</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=n>user_input</span> <span class=o>=</span> <span class=s2>&quot;1; DROP TABLE users;&quot;</span>  <span class=c1># Malicious input</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=n>query</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;SELECT * FROM users WHERE id = </span><span class=si>{</span><span class=n>user_input</span><span class=si>}</span><span class=s2>;&quot;</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>  <span class=c1># This executes malicious SQL code</span>
</span></code></pre></div> <p>Методи захисту: - Використання параметризованих запитів або підготовлених виразів (prepared statements). Це дозволяє відокремити дані від SQL-логіки.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=n>user_input</span> <span class=o>=</span> <span class=s2>&quot;1; DROP TABLE users;&quot;</span>  <span class=c1># This will now be treated as plain data</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=n>query</span> <span class=o>=</span> <span class=s2>&quot;SELECT * FROM users WHERE id = </span><span class=si>%s</span><span class=s2>;&quot;</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>query</span><span class=p>,</span> <span class=p>(</span><span class=n>user_input</span><span class=p>,))</span>  <span class=c1># Using parameterized query to prevent SQL injection</span>
</span></code></pre></div> <ul> <li>Застосування ORM (наприклад, Django ORM або SQLAlchemy), яке автоматично обробляє вхідні дані.</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>filter</span><span class=p>(</span><span class=nb>id</span><span class=o>=</span><span class=n>user_input</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span>  <span class=c1># ORM escapes input automatically</span>
</span></code></pre></div> <ul> <li>Валідація та фільтрація вхідних даних. Обмеження типів даних (наприклад, числові значення).</li> <li>Мінімізація прав користувачів бази даних. Акаунт, через який додаток підключається до бази, повинен мати лише необхідні привілеї.</li> <li>Використання веб-фаєрволів (WAF) для моніторингу та блокування шкідливих запитів.</li> <li>Логування та моніторинг запитів допоможуть вчасно виявити підозрілу активність.</li> </ul> <h4 id=view-materialised-view>View, Materialised View<a class=headerlink href=#view-materialised-view title="Permanent link">⚑</a></h4> <p>У SQL <strong>View</strong> (представлення) та <strong>Materialized View</strong> (матеріалізоване представлення) — це способи роботи з даними, що полегшують доступ до складних запитів або великих наборів даних. Вони мають схожість, але виконують різні завдання.</p> <p>Ключові відмінності</p> <ul> <li>View завжди показує актуальні дані, тоді як Materialized View може відображати застарілі дані до моменту рефрешу.</li> <li>View не займає додаткового місця в пам’яті, а Materialized View зберігає результати фізично.</li> <li>Materialized View краще підходить для великих обсягів даних, якщо запит часто повторюється і важливіша швидкість, ніж актуальність.</li> </ul> <p><strong>View</strong></p> <ul> <li>View — це віртуальна таблиця, яка базується на результаті SQL-запиту. Дані у View завжди актуальні, оскільки витягуються з базової таблиці під час виконання запиту.</li> <li>View не зберігає дані фізично, а лише визначення запиту.</li> <li>Використовується для спрощення складних запитів, підвищення безпеки (обмеження доступу до певних колонок або рядків) та створення абстракцій над базою даних.</li> <li>Оновлення даних через View можливе, якщо виконуються певні умови (наприклад, відсутність агрегатів у запиті).</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>active_users</span><span class=w> </span><span class=k>AS</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>email</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=k>FROM</span><span class=w> </span><span class=n>users</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=k>WHERE</span><span class=w> </span><span class=n>is_active</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>true</span><span class=p>;</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=c1>-- Запит до View</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>active_users</span><span class=p>;</span>
</span></code></pre></div> <p><strong>Materialized View</strong></p> <ul> <li>Materialized View — це таблиця, яка зберігає результат SQL-запиту фізично. Дані в Materialized View не оновлюються автоматично; потрібно виконувати рефреш для їх оновлення.</li> <li>Використовується для покращення продуктивності, особливо для часто виконуваних складних запитів або агрегатів на великих наборах даних.</li> <li>Рефреш може бути виконаний вручну або автоматично залежно від налаштувань.</li> <li>Materialized View може мати індекси для прискорення запитів.</li> </ul> <div class="language-sql highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>CREATE</span><span class=w> </span><span class=n>MATERIALIZED</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>monthly_sales</span><span class=w> </span><span class=k>AS</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=k>SELECT</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=k>FROM</span><span class=w> </span><span class=n>sales</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>product_id</span><span class=p>;</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=n>REFRESH</span><span class=w> </span><span class=n>MATERIALIZED</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>monthly_sales</span><span class=p>;</span><span class=w> </span><span class=c1>-- Refresh Materialized View</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>monthly_sales</span><span class=p>;</span><span class=w> </span><span class=c1>-- Query Materialized View</span>
</span></code></pre></div> <h4 id=explain-explain-analyze><code>EXPLAIN</code> та <code>EXPLAIN ANALYZE</code><a class=headerlink href=#explain-explain-analyze title="Permanent link">⚑</a></h4> <p><code>EXPLAIN</code> - це команда, яка надає інформацію про план виконання запиту. Вона показує, як база даних планує виконати запит, включаючи індекси, порядок виконання операцій та очікувані витрати, що допомагає в оптимізації запитів. Сам запит у разі не виконується.</p> <p><code>EXPLAIN ANALYZE</code> виконує пояснюваний вираз, навіть якщо це insert, update або delete.</p> <p>Приклад використання команди <code>EXPLAIN</code></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>EXPLAIN</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>age</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>30</span><span class=p>;</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=n>Seq</span><span class=w> </span><span class=n>Scan</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>employees</span><span class=w> </span><span class=p>(</span><span class=n>cost</span><span class=o>=</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=p>..</span><span class=mi>12</span><span class=p>.</span><span class=mi>50</span><span class=w> </span><span class=k>rows</span><span class=o>=</span><span class=mi>3</span><span class=w> </span><span class=n>width</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w> </span><span class=n>Filter</span><span class=p>:</span><span class=w> </span><span class=p>(</span><span class=n>age</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>30</span><span class=p>)</span>
</span></code></pre></div> <p>База даних буде виконувати послідовне сканування (Seq Scan) таблиці employees і застосовувати фільтр age &gt; 30. Поле cost показує передбачувані витрати виконання операції термінах часу і ресурсів.</p> <p><code>EXPLAIN</code> допомагає виявити потенційні проблеми у запитах, такі як відсутність індексного сканування, що може вказувати на необхідність додавання індексів або переписування запитів для покращення продуктивності.</p> <p>Використання <code>EXPLAIN</code> особливо корисне при роботі зі складними запитами або великими обсягами даних, оскільки дозволяє заздалегідь зрозуміти, як виконуватиметься запит, і які оптимізації можуть знадобитися.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="December 8, 2024 11:17:21 UTC"><span class=timeago datetime=2024-12-08T11:17:21+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="December 8, 2024 11:17:21 UTC">2024-12-08</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../ class="md-footer__link md-footer__link--prev" aria-label="Previous: Infrastructure"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Infrastructure </div> </div> </a> <a href=../database/ class="md-footer__link md-footer__link--next" aria-label="Next: Database"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Database </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/tavor118 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.footer", "navigation.instant", "navigation.top", "content.code.annotate", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.56ea9cef.min.js></script> <script src=../../js/timeago.min.js></script> <script src=../../js/timeago_mkdocs_material.js></script> </body> </html>